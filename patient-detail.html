<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Patient Details</title>
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
<header class="app-header">
  <div class="header-left">
    <img src="./logo.png" class="logo" />
    <strong>RPM Prototype</strong>
  </div>

  <nav class="header-nav">
    <a href="dashboard.html">Home</a>
    <a id="trendsLink" href="#">Trends</a>
    <a href="alerts.html">Alerts</a>
    <a href="profile.html">Profile</a>
    <button id="logoutBtn" class="btn-ghost">Log out</button>
  </nav>
</header>

<main class="container">
  <section class="card">
    <h2>Patient Details</h2>

    <div id="patientInfo">Loading…</div>

    <h3>Readings</h3>
    <div id="readingList">Loading…</div>

    <a id="backBtn" class="btn" href="dashboard.html">Back</a>
  </section>
</main>

<script type="module">
  import { getPatientById, getReadingsById } from "./api.js";

  const params = new URLSearchParams(location.search);
  const pid = params.get("pid");

  // Redirect if no pid
  if (!pid) location.href = "dashboard.html";

  // Trends link correctly passes pid
  document.getElementById("trendsLink").href = `trends.html?pid=${pid}`;

  // Load patient info
  const patient = await getPatientById(pid);
  const readings = await getReadingsById(pid);

  document.getElementById("patientInfo").innerHTML = `
    <p><strong>ID:</strong> ${patient.id}</p>
    <p><strong>Name:</strong> ${patient.fname} ${patient.lname}</p>
    <p><strong>Email:</strong> ${patient.email}</p>
  `;

  document.getElementById("readingList").innerHTML = readings
    .map(r => `
      <div class="reading-item">
        <p><strong>Date:</strong> ${r.date}</p>
        <p><strong>BP:</strong> ${r.sbp}/${r.dbp}</p>
        <p><strong>HR:</strong> ${r.hr}</p>
        <p><strong>Glucose:</strong> ${r.glucose}</p>
        <p><strong>Steps:</strong> ${r.steps}</p>
      </div>
    `)
    .join("");
</script>

<script src="./auth.js"></script>
  <script>
  const params = new URLSearchParams(location.search);
  const pid = params.get("pid");

  document.getElementById("trendsLink").href = `trends.html?pid=${pid}`;
</script>

</body>
</html>

